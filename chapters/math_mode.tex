\chapter{Good behaviour inside math mode}





\section{Using the right commands and symbols}



\subsection{General symbols}
\index{symbols}

Use the correct symbols.
\Cref{wrong symbol list} shows some popular sources of this problem.
\begin{table}[tb]
  \begin{center}
  \begin{tabular}{@{}lllll@{}}
      \toprule
      \theading{symbol}
      &
      \multicolumn{2}{c}{\theading{right commands}}
      &
      \multicolumn{2}{c}{\theading{wrong commands}}
    \\
    \midrule
      element relation
      &
      \comname{in}%
      \massindex{in}[\comname]
      &
      $\in$
      &
      \comname{epsilon}%
      \massindex{epsilon}[\comname]
      &
      $\epsilon$
    \\
      {}
      &
      {}
      &
      {}
      &
      \comname{varepsilon}%
      \massindex{varepsilon}[\comname]
      &
      $\varepsilon$
    \\
      {}
      &
      \comname{ni}%
      \massindex{ni}[\comname]
      &
      $\ni$
      &
      \comname{backepsilon}%
      \massindex{backepsilon}[\comname]
      &
      $\backepsilon$
    \\
    \cmidrule(lr){2-3} \cmidrule(l){4-5}
      empty set
      &
      \comname{emptyset}%
      \massindex{emptyset}[\comname]
      &
      $\emptyset$
      &
      \comname{phi}%
      \massindex{phi}[\comname]
      &
      $\phi$
    \\
      {}
      &
      \comname{varnothing}%
      \massindex{varnothing}[\comname]
      &
      $\varnothing$
      &
      {}
      &
      {}
    \\
    \cmidrule(lr){2-3} \cmidrule(l){4-5}
      set difference
      &
      \inlinecode{A {\tbs}setminus B}%
      \massindex{setminus}[\comname]
      &
      $A \setminus B$
      &
      \inlinecode{A {\tbs}backslash B}%
      \massindex{backslash}[\comname]
      &
      $A \backslash B$
    \\
      {}
      &
      \inlinecode{A {\tbs}smallsetminus B}%
      \massindex{smallsetminus}[\comname]
      &
      $A \smallsetminus B$
      &
      {}
      &
      {}
    \\
      {}
      &
      \inlinecode{A - B}\index{minus sign}
      &
      $A - B$
      &
      {}
      &
      {}
    \\
    \cmidrule(lr){2-3} \cmidrule(l){4-5}
      implication
      &
      \comname{implies}%
      \massindex{implies}[\comname]
      &
      $\implies$
      &
      \comname{Rightarrow}%
      \massindex[arrows]{Rightarrow}[\comname]
      &
      $\Rightarrow$
    \\
      {}
      &
      {}
      &
      {}
      &
      \inlinecode{=>}
      &
      $=>$
    \\
      {}
      &
      \comname{impliedby}%
      \massindex{impliedby}[\comname]
      &
      $\impliedby$
      &
      \comname{Leftarrow}%
      \massindex[arrows]{Leftarrow}[\comname]
      &
      $\Leftarrow$
    \\
      {}
      &
      {}
      &
      {}
      &
      \inlinecode{<=}
      &
      $<=$
    \\
    \cmidrule(lr){2-3} \cmidrule(l){4-5}
      equivalence
      &
      \comname{iff}%
      \massindex{iff}[\comname]
      &
      $\iff$
      &
      \comname{Leftrightarrow}%
      \massindex[arrows]{Leftrightarrow}[\comname]
      &
      $\Leftrightarrow$
    \\
      {}
      &
      {}
      &
      {}
      &
      \inlinecode{<=>}
      &
      <=>
    \\
    \cmidrule(lr){2-3} \cmidrule(l){4-5}
      definition
      &
      \comname{coloneqq}%
      \massindex{coloneqq}[\comname]
      &
      $\coloneqq$
      &
      \inlinecode{:=}
      &
      $:=$
    \\
      {}
      &
      \comname{eqqcolon}%
      \massindex{eqqcolon}[\comname]
      &
      $\eqqcolon$
      &
      \inlinecode{=:}
      &
      $=:$
    \\
    \cmidrule(lr){2-3} \cmidrule(l){4-5}
      norm
      &
      \inlinecode{{\tbs}| x {\tbs}|}%
      \massindex[delimiters]{\indexline}[\comname]
      &
      $\| x \|$
      &
      \inlinecode{|| x ||}
      &
      $|| x ||$
    \\
      {}
      &
      \inlinecode{{\tbs}lVert x {\tbs}rVert}%
      \massindex[delimiters]{lVert}[\comname]%
      \massindex[delimiters]{rVert}[\comname]
      &
      {}
      &
      {}
      &
      {}
    \\
    \cmidrule(lr){2-3} \cmidrule(l){4-5}
      pointy brackets
      &
      \inlinecode{{\tbs}langle x {\tbs}rangle}%
      \massindex[delimiters]{langle}[\comname]%
      \massindex[delimiters]{rangle}[\comname]
      &
      $\langle x \rangle$
      &
      \inlinecode{< x >}
      &
      $< x >$
    \\
    \cmidrule(lr){2-3} \cmidrule(l){4-5}
      infinity
      &
      \comname{infty}%
      \massindex{infty}[\comname]
      &
      $\infty$
      &
      \inlinecode{oo}
      &
      $oo$
    \\
    \cmidrule(lr){2-3} \cmidrule(l){4-5}
      function colon
      &
      \inlinecode{f {\tbs}colon X {\tbs}to Y}%
      \massindex{colon}[\comname]%
      \massindex{ni}[\comname]
      &
      $f \colon X \to Y$
      &
      \inlinecode{f : X {\tbs}to Y}
      &
      $f : X \to Y$
    \\
    \bottomrule
  \end{tabular}
  \end{center}
  \caption{Right symbols and wrong symbols.}
  \label{wrong symbol list}
\end{table}
Note that the commands~\comname{rightarrow}\massindex[arrows]{rightarrow}[\comname] and~\comname{to}\massindex[arrows]{to}[\comname] give the same arrow.
So use whichever is more appropriate in the given situation.



\subsection{Operations}

Many mathematical operations have both a binary version and an operator version, where the operation can range over some index set.
One should not confuse the two of them.
\Cref{binary vs operator} shows some popular binary operations and their operator counterpart.
\begin{table}[tb]
  \begin{center}
    \begingroup
    \renewcommand{\arraystretch}{1.3}
    \begin{tabular}{@{}llclc@{}}
      \toprule
      \theading{operation}
      &
      \multicolumn{2}{c}{\theading{binary}}
      &
      \multicolumn{2}{c}{\theading{generalized}}
      \\
      \cmidrule(lr){2-3}
      \cmidrule(l){4-5}
      sum
      &
      \inlinecode{+}
      &
      $a + b$
      &
      \comname{sum}
      &
      $\sum_i x_i$
      \\
      multiplication
      &
      \comname{cdot}
      &
      $a \cdot b$
      &
      \comname{prod}
      &
      $\prod_i x_i$
      \\
      direct sum
      &
      \comname{oplus}
      &
      $A \oplus B$
      &
      \comname{bigoplus}
      &
      $\bigoplus_i X_i$
      \\
      tensor product
      &
      \comname{otimes}
      &
      $A \otimes B$
      &
      \comname{bigotimes}
      &
      $\bigotimes_i X_i$
      \\
      wedge
      &
      \comname{wedge}
      &
      $a \wedge b$
      &
      \comname{bigwedge}
      &
      $\bigwedge_i X_i$
      \\
      union
      &
      \comname{cup}
      &
      $A \cup B$
      &
      \comname{bigcup}
      &
      $\bigcup_i X_i$
      \\
      intersection
      &
      \comname{cap}
      &
      $A \cap B$
      &
      \comname{bigcap}
      &
      $\bigcap_i X_i$
      \\
      product
      &
      \comname{times}
      &
      $A \times B$
      &
      \comname{prod}
      &
      $\prod_i X_i$
      \\
      {}
      &
      \comname{sqcap}
      &
      $A \sqcap B$
      &
      \comname{bigsqcap}
      &
      $\bigsqcap_i X_i$
      \\
      coproduct
      &
      \comname{amalg}
      &
      $A \amalg B$
      &
      \comname{coprod}
      &
      $\coprod_i X_i$
      \\
      {}
      &
      \comname{sqcup}
      &
      $A \sqcup B$
      &
      \comname{bigsqcup}
      &
      $\bigsqcup_i X_i$
      \\
      \bottomrule
    \end{tabular}
    \endgroup
  \end{center}
  \caption{Binary operation and operator version.}
  \label{binary vs operator}
\end{table}
The command \comname{bigsqcap} requires the package \packname{stmaryrd}.



\subsection{Negations}

For some mathematical symbols there also exists a negated version, which is formed by diagonal line through the symbol.
A general way of introducing such a line is the command \comname{not}\massindex[negation]{not}[\comname].
\begin{showlatex}*{Using \comname{not}}
  It follows that $A \not\ni x$.
\end{showlatex}
But in practice this command should seldom be used, as it often produces very bad looking output.
Consider the following example:
\begin{showlatex}{Why not to use \comname{not}}
  Hence $A \not\implies B$.
\end{showlatex}
There are two solutions to this problem:

Many symbols already have a predefined lined-out version available.
A few of them are collected in~\cref{negation list}.
\begin{table}[tb]
  \begin{center}
  \begin{tabular}{@{}lclc@{}}
    \toprule
      \multicolumn{2}{c}{\theading{right}}
    &
      \multicolumn{2}{c}{\theading{wrong}}
    \\
    \cmidrule(r){1-2} \cmidrule(l){3-4}
      \comname{notin}%
      \massindex[negation]{notin}[\comname]
      &
      $\notin$
      &
      \inlinecode{{\tbs}not{\tbs}in}
      &
      $\not\in$
    \\
      \comname{nexists}%
      \massindex[negation]{nexists}[\comname]
      &
      $\nexists$
      &
      \inlinecode{{\tbs}not{\tbs}exists}
      &
      $\not\exists$
    \\
      \comname{neq}%
      \massindex[negation]{neq}[\comname]
      &
      $\neq$
      &
      \inlinecode{{\tbs}not =}
      &
      $\not =$
    \\
      \comname{nleq}%
      \massindex[negation]{nleq}[\comname]
      &
      $\nleq$
      &
      \inlinecode{{\tbs}not{\tbs}leq}
      &
      $\not\leq$
    \\
      \comname{nrightarrow}%
      \massindex[negation,arrows]{notrightarrow}[\comname]
      &
      $\nrightarrow$
      &
      \inlinecode{{\tbs}not{\tbs}rightarrow}
      &
      $\not\rightarrow$
    \\
    \bottomrule
  \end{tabular}
  \end{center}
  \caption{Negated versions of popular symbols.}
  \label{negation list}
\end{table}
If the required symbol is not predefined then the command~\comname{centernot}\massindex[negation]{centernot}[\comname] from the package~\packname{centernot}\massindex[packages]{centernot}[\packname] often produces better looking output than~\comname{not}:
\begin{showlatex}{Using the command~\comname{centernot}}
  Consider
  \[
    A \centernot\ni x
    \quad\text{versus}\quad
    \quad
    A \not\ni x \,.
  \]
  Consider also
  \[
    A \centernot\implies B
    \quad\text{versus}\quad
    A \not\implies B \,.
  \]
\end{showlatex}



\subsection{Don’t use \comtitle{limits}}

People seem to think that they have to put \comname{limits}\massindex[limits]{limits}[\comname] after a command to add limits to it:
\begin{showlatex}*{Using~\comname{limits}}
\[
  \sum\limits_{k=1}^n k
  =
  \frac{n(n+1)}{2}
\]
\end{showlatex}
But this is not only unnecessary, but also dangerous.
It is unnecessary because (most of) the commands in questions already have this functionality built in:
\begin{showlatex}*{Using built-in limits}
\[
  \sum_{k=1}^n k
  =
  \frac{n(n+1)}{2}
\]
\end{showlatex}
These built-in limits have the advantage that they can distinguish between inline math and display math:
\begin{showlatex}*{Inline math vs.\ display math with built-in limits}
The sum $\sum_{k=0}^n 2^k = 2^{n+1} - 1$ is inline while the sum
\[
  \sum_{k=0}^n 3^k
  \neq
  3^{n+1} - 1
\]
is in display mode.
\end{showlatex}
We can see that the inline version does not only use the smaller summation sign but also sets the limits to the right of the summation sign.
This is a feature which \comname{limits} version is missing:
\begin{showlatex}*{Inline math with~\comname{limits}}
So here is some text which will generate some lines.
The text itself isn’t important, but we really want it to fill some lines.
The important thing is the sum $\sum\limits_{k=0}^n k$.
Well, not really the sum itself, but the use of \texttt{{\textbackslash}limits} for typesetting it.
\end{showlatex}
The limits are still placed above the top and below the summation sign.
This has its price:
The line in which the sum resides breaks the usual vertical space between lines, which gives the text an inconsistent and unorganized look.
Compare this to the version without \comname{limits}:
\begin{showlatex}*{Inline with built-in limits}
So here is some text which will generate some lines.
The text itself isn’t important, but we really want it to fill some lines.
The important thing is the sum $\sum_{k=0}^n k$.
Well, not really the sum itself, but use of built-in limits for typesetting it.
\end{showlatex}
Here the line distance is nicely consistent and pleasing to the eye.

The usual predefined commands on which one would expect limits already have them defined, e.g.\ \comname{sum}, \comname{prod} or \comname{lim}, as the following example shows:
\begin{showlatex}{Inline vs.\ display for different commands with built-in limits}
Compare the inline versions $\sum_{k=0}^n k$ and $\prod_{k=1}^n k$ and $\lim_{n \to \infty} a_n$ with the display versions
\[
  \sum_{k=0}^n k \,,
  \quad
  \prod_{k=1}^n k \,,
  \quad
  \lim_{n \to \infty} a_n \,.
\]
\end{showlatex}
If a new commands are defined with~\comname{DeclareMathOperator}\massindex[defining commands]{DeclareMathOperator}[\comname] or~\comname{operatorname}\massindex[defining commands]{operatorname}[\comname] then one can make them support limits by using \comname{DeclareMathOperator*}\massindex[defining commands, limits]{DeclareMathOperator*}[\comname] and \comname{operatorname*}\massindex[defining commands, limits]{operatorname*}[\comname] instead.
Suppose for example that we have made in the preamble the following definition:
\begin{showcode}{Using \comname{DeclareMathOperator*} to define~\comname{colim}}
\DeclareMathOperator*{\colim}{colim}
\end{showcode}
We can then do the following:
\begin{showlatex}{Using~\comname{colim}}
Inline we have $\colim_{X' \leq X} F(X')$ and in display mode we get
\[
  \colim_{X' \leq X} F(X') \,.
\]
\end{showlatex}
The command~\comname{operatorname*} was named~\comname{operatornamewithlimits} in the past, but this name is deprecated.

% If for some extremly strange reason one \emph{really} needs the limits to be in display style, then one should commit to it by using \comname{displaystyle}.
% Consider the following example:
% \begin{showlatex}{Forcing displaystyle with \comname{displaystyle}}
% \[
%   \begin{pmatrix}
%     \frac{n^2+1}{n^2 + 2}
%     &
%     \frac{n^2+2}{n^2 + 3}
%     \\
%     \frac{n^2+2}{n^2 + 3}
%     &
%     \frac{n^2+3}{n^2 + 4}
%   \end{pmatrix}
%   =
%   \begin{pmatrix}
%     \displaystyle
%     \frac{n^2+1}{n^2 + 2}
%     &
%     \displaystyle
%     \frac{n^2+2}{n^2 + 3}
%     \\[1.5em]
%     \displaystyle
%     \frac{n^2+2}{n^2 + 3}
%     &
%     \displaystyle
%     \frac{n^2+3}{n^2 + 4}
%   \end{pmatrix}
% \]
% \end{showlatex}
% In the above example we have put~\comname{displaystyle} before every matrix entry to ensure that it has the usual style of display mathematics.
% We have also put replaced the basic line break~\comname{\tbs} by~\inlinecode{{\tbs}{\tbs}[1.5em]} for some additional spacing between the two rows of the resulting matrix.
% (Otherwise the fractions are far too close.)



\subsection{Use extensible arrows instead of \comtitle{overset} and \comtitle{underset}}
\label{extensible arrows}

Some people put text above or under arrows by wrongly using the commands~\comname{overset}\massindex{overset}[\comname] or \comname{underset}\massindex{underset}[\comname]:
\begin{showlatex}{Using~\comname{overset} and~\comname{underset} to put text above or below an arrow}
\[
  X
  \overset{f}{\longrightarrow}
  Y
  \underset{g \circ h \circ k}{\longrightarrow}
  Z
\]
\end{showlatex}
We can see above that the length of the arrow does not adjust to the size of the text above it or below it.
The proper way to put text on top of an arrow or bellow an arrow of the form~\enquote{$\to$} is therefore the command~\comname{xrightarrow}\massindex[arrows]{xrightarrow}[\comname]:
\begin{showlatex}{Using~\comname{xrightarrow} to put text above or below an arrow}
\[
  X
  \xrightarrow{f}
  Y
  \xrightarrow[g \circ h \circ k]{}
  Z \,.
\]
\end{showlatex}
The package~\packname{amsmath}\massindex[packages]{amsmath}[\packname] defines only the two most basic extensible arrows\index{extensible arrows}\index{arrows!extensible}.
Many more kinds of extensible arrows are provided by the package~\packname{mathtools}\massindex[packages]{mathtools}[\packname] and some more are contained in the package~\packname{extarrows}\massindex[packages]{extarrows}[\packname].
An overview of the various kinds of extensible arrows can be found in \cref{extensible arrow table}.
\begin{table}[tb]
  \begin{center}
  \begingroup
  \renewcommand{\arraystretch}{0.9}
  \begin{tabular}{@{}lccc@{}}
    \toprule
    \packname{amsmath}
    &
    \begin{tabular}{@{}c@{}}
      $A \xrightarrow{f} B$
      \\
      \comname{xrightarrow}%
      \massindex[arrows]{xrightarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xleftarrow{f} B$
      \\
      \comname{xleftarrow}%
      \massindex[arrows]{xleftarrow}[\comname]
    \end{tabular}
    &
    {}
    \\[1.5em]
%     \midrule
    \packname{mathtools}
    &
    \begin{tabular}{@{}c@{}}
      $A \xmapsto{f} B$
      \\
      \comname{xmapsto}%
      \massindex[arrows]{xmapsto}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xleftrightarrow{f} B$
      \\
      \comname{xleftrightarrow}%
      \massindex[arrows]{xleftrightarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xRightarrow{f} B$
      \\
      \comname{xRightarrow}%
      \massindex[arrows]{xRightarrow}[\comname]
    \end{tabular}
    \\[1.5em]
    {}
    &
    \begin{tabular}{@{}c@{}}
      $A \xLeftarrow{f} B$
      \\
      \comname{xLeftarrow}%
      \massindex[arrows]{xLeftarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xLeftrightarrow{f} B$
      \\
      \comname{xLeftrightarrow}%
      \massindex[arrows]{xLeftrightarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xhookleftarrow{f} B$
      \\
      \comname{xhookleftarrow}%
      \massindex[arrows]{xhookleftarrow}[\comname]
    \end{tabular}
    \\[1.5em]
    {}
    &
    \begin{tabular}{@{}c@{}}
      $A \xhookrightarrow{f} B$
      \\
      \comname{xhookrightarrow}%
      \massindex[arrows]{xhookrightarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xrightharpoondown{f} B$
      \\
      \comname{xrightharpoondown}%
      \massindex[arrows]{xrightharpoondown}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xrightharpoonup{f} B$
      \\
      \comname{xrightharpoonup}%
      \massindex[arrows]{xrightharpoonup}[\comname]
    \end{tabular}
    \\[1.5em]
    {}
    &
    \begin{tabular}{@{}c@{}}
      $A \xrightleftharpoons{f} B$
      \\
      \comname{xrightleftharpoons}%
      \massindex[arrows]{xrightleftharpoons}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xleftharpoondown{f} B$
      \\
      \comname{xleftharpoondown}%
      \massindex[arrows]{xleftharpoondown}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xleftharpoonup{f} B$
      \\
      \comname{xleftharpoonup}%
      \massindex[arrows]{xleftharpoonup}[\comname]
    \end{tabular}
    \\[1.5em]
    {}
    &
    \begin{tabular}{@{}c@{}}
      $A \xleftrightharpoons{f} B$
      \\
      \comname{xleftrightharpoons}%
      \massindex[arrows]{xleftrightharpoons}[\comname]
    \end{tabular}
    &
    {}
    &
    {}
    \\[1.5em]
%     \midrule
    \packname{extarrows}
    &
    \begin{tabular}{@{}c@{}}
      $A \xlongequal{f} B$
      \\
      \comname{xlongequal}%
      \massindex[arrows]{xlongequal}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xleftrightarrow{f} B$
      \\
      \comname{xleftrightarrow}%
      \massindex[arrows]{xleftrightarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xLeftrightarrow{f} B$
      \\
      \comname{xLeftrightarrow}%
      \massindex[arrows]{xLeftrightarrow}[\comname]
    \end{tabular}
    \\[1.5em]
    {}
    &
    \begin{tabular}{@{}c@{}}
      $A \xlongleftarrow{f} B$
      \\
      \comname{xlongleftarrow}%
      \massindex[arrows]{xlongleftarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xlongrightarrow{f} B$
      \\
      \comname{xlongrightarrow}%
      \massindex[arrows]{xlongrightarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xlongleftrightarrow{f} B$
      \\
      \comname{xlongleftrightarrow}%
      \massindex[arrows]{xlongleftrightarrow}[\comname]
    \end{tabular}
    \\[1.5em]
    {}
    &
    \begin{tabular}{@{}c@{}}
      $A \xLongleftarrow{f} B$
      \\
      \comname{xLongleftarrow}%
      \massindex[arrows]{xLongleftarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xLongrightarrow{f} B$
      \\
      \comname{xLongrightarrow}%
      \massindex[arrows]{xLongrightarrow}[\comname]
    \end{tabular}
    &
    \begin{tabular}{@{}c@{}}
      $A \xLongleftrightarrow{f} B$
      \\
      \comname{xLongleftrightarrow}%
      \massindex[arrows]{xLongrightarrow}[\comname]
    \end{tabular}
    \\
    \bottomrule
  \end{tabular}
  \endgroup
  \end{center}
 \caption{Extensible arrows in \packname{amsmath}, \packname{mathtools} and \packname{extarrows}.}
 \label{extensible arrow table}
\end{table}

The author recommends to define custom commands as shortcuts for the most used arrows.
\begin{showlatex}{Defining arrow commands as shortcuts}
\newcommand{\xto}{\xrightarrow}
\newcommand{\xlongto}[1]{\xlongrightarrow{\;#1\;}}
The function $A \xto{f} B$ is the same as
\[
  A \xlongto{f} B \,.
\]
\end{showlatex}

% TODO: Defining new kind of stretchable arrows





\subsection{Know your ellipses}
\index{dots!zzzz@\igobble |see {ellipsis}}
\index{ellipses|(}

An ellipsis\index{ellipses} should \emph{never} by written as~\inlinecode{...} (three single dots).
{\LaTeX} instead provides different kinds of ellipses to use in math mode, namely
\begin{center}
    \comname{dotsb},
    \quad
    \comname{dotsc},
    \quad
    \comname{dotsm},
    \quad
    \comname{dotsi},
    \quad
    \comname{dotso},
    \\
    \comname{cdots},
    \quad
    \comname{ddots},
    \quad
    \comname{vdots},
    \quad
    \comname{ldots}.
\end{center}
Each of these have they own role and (mostly) distinct look and feel.
There are two groups of ellipses.
The first group consists of \comname{dotsb}, \comname{dotsc}, \comname{dotsm}, \comname{dotsi},\comname{dotso}, whereas the second group consists of \comname{cdots}, \comname{ddots}, \comname{vdots}, \comname{ldots}.

The ellipses in the first group are named after their function, see \cref{ellipses with function}.
\begin{table}[tb]
  \begin{center}
  \begingroup
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{@{}lll@{}}
    \toprule
    %
    \theading{command}
    &
    \theading{where to use}
    &
    \theading{example}
    \\
    \midrule
    %
    \comname{dotsb}%
    \massindex[ellipses]{dotsb}[\comname]
    &
    between binary relations
    &
    $x_1 \leq \dotsb \leq x_n$
    \\
    {}
    &
    and binary operations
    &
    $x_1 + \dotsb + x_n$
    \\
    \comname{dotsc}%
    \massindex[ellipses]{dotsc}[\comname]
    &
    between commas
    &
    $x_1, \dotsc, x_n$
    \\
    \comname{dotsm}%
    \massindex[ellipses]{dotsm}[\comname]
    &
    abbreviating multiplication
    &
    $x_1 \dotsm x_n$
    \\
    \comname{dotsi}%
    \massindex[ellipses]{dotsi}[\comname]
    &
    iterated integrals\index{integral}
    &
    $\int_{X_1} \dotsi \int_{X_n}$
    \\
    \comname{dotso}%
    \massindex[ellipses]{dotso}[\comname]
    &
    others
    &
    {}
    \\
    \bottomrule
  \end{tabular}
  \endgroup
  \end{center}
  \caption{Ellipses with a specific functions.}
  \label{ellipses with function}
\end{table}
Note that the members of this group all have names of the form \comname{dots*}, where \optname{*} is a letter that specifies the semantic use of the ellipsis.

The ellipses in the second group are not named after their function but after their orientation, see \cref{ellipses with orientation}
\begin{table}[tb]
  \begin{center}
  \begingroup
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{@{}llc@{}}
    \toprule
    %
    \theading{command}
    &
    \theading{description}
    &
    \theading{look}
    \\
    \midrule
    %
    \comname{cdots}%
    \massindex[ellipses]{cdots}[\comname]
    &
    Horizontal dots, vertically centered.
    &
    $\cdots$
    \\
    \comname{ddots}%
    \massindex[ellipses]{ddots}[\comname]
    &
    Diagonal dots.
    &
    $\ddots$
    \\
    \comname{vdots}%
    \massindex[ellipses]{vdots}[\comname]
    &
    Vertical dots, horizontally centered.
    &
    $\vdots$
    \\
    \comname{ldots}%
    \massindex[ellipses]{ldots}[\comname]
    &
    Lowered dots.
    &
    $\ldots$
    % making this line as high as the others
    \vphantom{$\vdots$}
    \\
    \bottomrule
  \end{tabular}
  \endgroup
  \end{center}
  \caption{Ellipses with a specific orientation.}
  \label{ellipses with orientation}
\end{table}
The ellipses~\comname{cdots},~\comname{ddots} and~\comname{vdots} are typically used in matrices.
\begin{showlatex}{Typical usage of the ellipses~\comname{cdots},~\comname{vdots},~\comname{ddots}}
\[
  \begin{pmatrix}
    a_{11} & \cdots & a_{1n} \\
    \vdots & \ddots & \vdots \\
    a_{n1} & \cdots & a_{nn}
  \end{pmatrix}
\]
\end{showlatex}
The command~\comname{ldots} may be used to denote left out digits or symbols.
\begin{showlatex}{Using the ellipsis~\comname{ldots}}
We find that
\[
  x = 0.1234567891011\ldots
\]
Consider the word $w = a_1 \ldots a_n$ where $a_1, \dotsc, a_n$ are letters in an alphabet $\Sigma$.
\end{showlatex}
Note that the members of this second group of dots all have names of the form~\comname{*dots}, where~\optname{*} is a letter that specified the positioning of these dots.

% The following should \emph{never} be used to denote a product:
% \begin{showcode}{Wrong way of abbreviating multiplication~I}
% x_1 \cdot {any kind of dots} \cdot x_n
% \end{showcode}
% So all of the following are \emph{wrong}, and some of them look even worse then the other ones.
% \begin{showlatex}*{Wrong way of abbreviating multiplication~II}
% \begin{gather*}
%   x_1 \cdot \dotsb \cdot x_n \\
%   x_1 \cdot \dotsc \cdot x_n \\
%   x_1 \cdot \dotsm \cdot x_n \\
%   x_1 \cdot \dotsi \cdot x_n \\
%   x_1 \cdot \cdots \cdot x_n \\
%   x_1 \cdot \ldots \cdot x_n
% \end{gather*}
% \end{showlatex}
% (The author hopes that nobody is stupid enough to even trying using \comname{ddots} or \comname{vdots} in this situation.)

So overall one should use the ellipses~\comname{cdots}, \comname{ddots} and \comname{vdots} for matrices, and otherwise the ellipses~\comname{dotsb}, \comname{dotsc}, \comname{dotsm}, \comname{dotsi} and occasionally \comname{dotso}.

There also exists the generic command~\comname{dots}\massindex[ellipses]{dots}[\comname] which tries to automagically use the right kind of positioning and spacing.
But the author recommends not using this command as it can lead to inconsistent results:
\begin{showlatex}{Inconsistent results with \comname{dots}}
The ellipses in $x_1 \leq x_2 \leq \dots \leq x_n$ and $y_1 \leq y_2 \leq \dots$ should look the same.
\end{showlatex}

\index{ellipses|)}



\subsection{Know your matrices}
\index{matrices|(}

The package~\packname{amsmath}\massindex[packages]{amsmath}[\packname] provides various environments for matrices, the most basic of which is the environment~\envname{matrix}\massindex[matrices!normal sized]{matrix}[\envname].
\begin{showlatex}*{The basic matrix environment~\envname{matrix}}
\[
  \begin{matrix}
    a & b \\
    c & d
  \end{matrix}
\]
\end{showlatex}
There are five more variants of this basic matrix environment, that put different delimiters around the matrix.
The package~\packname{mathtools}\massindex[packages]{mathtools}[\packname] also provides small versions of all six kinds of matrices.
See \cref{table of matrices} for a table of all these kinds of matrices.
\begin{table}
  \begin{center}
  \begin{tabular}{@{}lccc@{}}
    \toprule
    %
    \theading{size}
    &
    \multicolumn{3}{c}{\theading{matrices}}
    \\
    \midrule
    %
    normal
    &
    \begin{tabular}{c}
      $\begin{matrix} a & b \\ c & d \end{matrix}$ \\
      \envname{matrix}%
      \massindex[matrices!normal sized]{matrix}[\envname]
    \end{tabular}
    &
    \begin{tabular}{c}
      $\begin{pmatrix} a & b \\ c & d \end{pmatrix}$ \\
      \envname{pmatrix}%
      \massindex[matrices!normal sized]{pmatrix}[\envname]
    \end{tabular}
    &
    \begin{tabular}{c}
      $\begin{bmatrix} a & b \\ c & d \end{bmatrix}$ \\
      \envname{bmatrix}%
      \massindex[matrices!normal sized]{bmatrix}[\envname]
    \end{tabular}
    \\[2.5em]
    {}
    &
    \begin{tabular}{c}
      $\begin{Bmatrix} a & b \\ c & d \end{Bmatrix}$ \\
      \envname{Bmatrix}%
      \massindex[matrices!normal sized]{Bmatrix}[\envname]
    \end{tabular}
    &
    \begin{tabular}{c}
      $\begin{vmatrix} a & b \\ c & d \end{vmatrix}$ \\
      \envname{vmatrix}%
      \massindex[matrices!normal sized]{vmatrix}[\envname]
    \end{tabular}
    &
    \begin{tabular}{c}
      $\begin{Vmatrix} a & b \\ c & d \end{Vmatrix}$ \\
      \envname{Vmatrix}%
      \massindex[matrices!normal sized]{Vmatrix}[\envname]
    \end{tabular}
    \\[2.5em]
    small
    &
    \begin{tabular}{c}
      $\begin{smallmatrix} a & b \\ c & d \end{smallmatrix}$ \\
      \envname{smallmatrix}%
      \massindex[matrices!small sized]{smallmatrix}[\envname]
    \end{tabular}
    &
    \begin{tabular}{c}
      $\begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix}$ \\
      \envname{psmallmatrix}%
      \massindex[matrices!small sized]{psmallmatrix}[\envname]
    \end{tabular}
    &
    \begin{tabular}{c}
      $\begin{bsmallmatrix} a & b \\ c & d \end{bsmallmatrix}$ \\
      \envname{bsmallmatrix}%
      \massindex[matrices!small sized]{bsmallmatrix}[\envname]
    \end{tabular}
    \\[2.5em]
    {}
    &
    \begin{tabular}{c}
      $\begin{Bsmallmatrix} a & b \\ c & d \end{Bsmallmatrix}$ \\
      \envname{Bsmallmatrix}%
      \massindex[matrices!small sized]{Bsmallmatrix}[\envname]
    \end{tabular}
    &
    \begin{tabular}{c}
      $\begin{vsmallmatrix} a & b \\ c & d \end{vsmallmatrix}$ \\
      \envname{vsmallmatrix}%
      \massindex[matrices!small sized]{vsmallmatrix}[\envname]
    \end{tabular}
    &
    \begin{tabular}{c}
      $\begin{Vsmallmatrix} a & b \\ c & d \end{Vsmallmatrix}$ \\
      \envname{Vsmallmatrix}%
      \massindex[matrices!small sized]{Vsmallmatrix}[\envname]
    \end{tabular}
    \\
    \bottomrule
  \end{tabular}
  \end{center}
  \caption{Different kinds of matrices.}
  \label{table of matrices}
\end{table}

The package~\packname{mathtools}\massindex[packages]{mathtools}[\packname] also provides starred versions of the matrices.
These starred versions allow to specify as an optional argument the alignment of the columns, see \cref{table of matrices}.
The three possible arguments are~\optname{l}\massindex{l}[\optname] for left-alignment,~\optname{c}\massindex{c}[\optname] for centered alignment and~\optname{r}\massindex{r}[\optname] for right-alignment.
The standard alignment is~\optname{c}.
\begin{showlatex}{Aligning matrix entries}
\[
  \begin{bmatrix*}[l]
      a & -b \\
     -c &  d
  \end{bmatrix*}
  \qquad
  \begin{bmatrix*}[c]
    a & -b \\
    -c &  d
  \end{bmatrix*}
  \qquad
  \begin{bmatrix*}[r]
     a & -b \\
    -c &  d
  \end{bmatrix*}
  \qquad
  \begin{bmatrix}
     a & -b \\
    -c &  d
  \end{bmatrix}
\]
\end{showlatex}

One should choose the kind of matrix, its size and alignment dependent on convention, usage and the matrix entries. 
\begin{showlatex}*{Using the right kind of matrix}
We consider the morphism
\[
  X \oplus Y
  \xrightarrow{\,
    \begin{bsmallmatrix*}[r]
      f & -d \\
      0 &  g
    \end{bsmallmatrix*}
    \,
  }
  X' \oplus Y' \,.
\]
\end{showlatex}

\index{matrices|)}





\section{Avoid bad notation}



\subsection{Don’t use \comtitle{subset}}

Some people use~$\subset$~(\comname{subset}\massindex{subset}[\comname]) to denote inclusion and~$\subsetneq$~(\comname{subsetneq}\massindex{subsetneq}[\comname]) to denote proper inclusion, while some other people use~$\subseteq$~(\comname{subseteq}\massindex{subseteq}[\comname]) to denote inclusion and~$\subset$ to denote proper inclusion.
The second convention has the advantage of making sense and being consistent with the usual use of~$\leq$ and~$<$, whereas the first convention has the non-advantage of existing.
The problem is that both conventions are wide-spread while using the symbol~$\subset$ is different ways.

The conflict between the above two conventions has abused the symbol~$\subset$ to a point that it should \emph{never} be used.
Instead one should always use~$\subseteq$ for inclusion, $\subsetneq$ for proper inclusion and~$\nsubseteq$~(\comname{nsubseteq}\massindex{nsubseteq}[\comname]) for non-inclusion.

Some people prefer the symbols~$\subseteqq$~(\comname{subseteqq}\massindex{subseteqq}[\comname]) and~$\subsetneqq$~(\comname{subsetneqq}\massindex{subsetneqq}[\comname]) instead.
The author thinks that these symbols are unnecessary large and recommends not to use them.
(But they do at least leave poor old~$\subset$ alone.)



\subsection{Don’t underline}
\index{underlining}

Underlining works well on the blackboard, in handwriting, and was useful in the in the (dark) age of typewriters.
Don’t do it in {\LaTeX}.



\subsection{Use \texorpdfstring{$\mathrm{d}x$}{dx} instead of \texorpdfstring{$dx$}{dx}}

A differential\index{differential} is written as \inlinecode{{\tbs}mathrm\{d\}x}, not as \inlinecode{dx}.
When it occurs at the end of an integral\index{integral} then a slight spacing~\comname{,}\index{spacing!in math mode} is also introduced in front of it.
So don’t do the following:
\begin{showlatex}*{Wrong kind of differentials}
\[
  \int_a^b f(x) dx
\]
\end{showlatex}
Instead do the following:
\begin{showlatex}*{Right kind of differential}
\[
  \int_a^b f(x) \,\mathrm{d}x
\]
\end{showlatex}



\subsection{Don’t force fancy fractions}
\index{fractions|(}

When fractions are placed inline, are part of an exponent or part of an index, then they should be of the form $a/b$.
The notation
\[
  \frac{a}{b}
\]
is reserved for display style.
So don’t do the following:
\begin{showlatex}{Full fractions in exponent, index and inline}
Consider $e^{\frac{1}{x}}$ and $x_{\frac{1}{n}}$ and $\frac{2}{3}$.
\end{showlatex}
Do the following instead:
\begin{showlatex}{Flat fractions in exponent, index and inline}
Consider $e^{1/x}$ and $x_{1/n}$ and $2/3$.
\end{showlatex}

Don’t use funky fractions like $\faktor{a}{b}$. They’ll make you go blind and burn down your house.

% TODO: Finding out the proper term for flat fractions. See Chicago Manual?

\index{fractions|)}





\section{Defining new commands}

Many mathematical operators have predefined commands, which should be used when needed.
\begin{showlatex}{Using commands vs.\ not using them}
Use $\sin(x)$ instead of $sin x$, use $\dim V$ instead of $dim V$ and use $\lim_{n \to \infty} a_n$ instead of $lim_{n \to \infty} a_n$.
\end{showlatex}
New commands can be defined in various ways:


\subsection{\comtitle{DeclareMathOperator}}

Commands of the form~\comname{WordCommand}, that are supposed to print~\enquote{$\mathrm{WordOutupt}$}, can easily be defined using the command~\comname{DeclareMathOperator}\massindex[defining commands]{DeclareMathOperator}[\comname].
\begin{showcode}{Syntax of~\comname{DeclareMathOperator}}
\DeclareMathOperator{\WordCommand}{WordOutput}
\end{showcode}
The command \comname{DeclareMathOperator} can only be used in the preamble.

To define the command~\comname{End} we use the following text in the preamble:
\begin{showcode}{Declaring a mathematical operator with~\comname{DeclareMathOperator}}
% in the preamble:
\DeclareMathOperator{\End}{End}
\end{showcode}
The command \comname{End} can then be used in the usual way:
\begin{showlatex}{Using a declared mathematical operator}
Thus $\End(V) = \End_k(V)$ becomes a vector space.
\end{showlatex}

If a command~\comname{WordCommand} is defined with \comname{DeclareMathOperator} then {\LaTeX} will automatically insert some space around\index{spacing!in math mode} \comname{WordCommand} when needed:
\begin{showlatex}*{Automatic spacing of~\comname{DeclareMathOperator}}
\begin{align*}
&x \End V
\\
&x \End(V)
\\
&x \End {(V)}
\end{align*}
\end{showlatex}
Note that in the first expression {\LaTeX} inserts some spacing both to the left and to the right of $\End$.
In the second expression {\LaTeX} observes that the used math operator is follows by a parenthesis and thus inserts no additional spacing.
For the third expression we prevent {\LaTeX} from making such an observation by using a pair of curly brackets.

This behavior leads to a bad looking output when \comname{DeclareMathoperator} is abused.
Suppose that we want a command \comname{Complex} that inserts the code \comname{mathbb\{C\}}.
\begin{showcode}{Wrong way of using \comname{DeclareMathOperator}}
% in the preamble:
\DeclareMathOperator{\Complex}{\mathbb{C}}
\end{showcode}
This will lead to the following problem:
\begin{showlatex}{Wrong output when \comname{DeclareMathOperator} is abused}
The span of $x_1, \dotsc, x_n \in \Complex^m$ equals $\Complex x_1 + \dotsb + \Complex x_n$.
\end{showlatex}
We expect the output $\mathbb{C} x_1 + \dotsb + \mathbb{C} x_n$ but get some unwanted spacing instead.



\subsection{\comtitle{operatorname}}

The command~\comname{operatorname}\massindex[defining commands]{operatorname}[\comname] can be used to give the formatting of a mathemical operator without defining a new command.
\begin{showlatex}{Using \comname{operatorname}}
Thus $\operatorname{Hom}(V,W) = \operatorname{Hom}_k(V,W)$ becomes a vector space.
\end{showlatex}
If the same command is used multiple times then one should use \comname{DeclareMathOperator} instead of \comname{operatorname}, to keep the code clean.



\subsection{Don’t abuse \comtitle{mathrm}}

The commands~\comname{mathrm}\massindex{mathrm}[\comname] and \comname{operatorname} do not give the same formatting.
With \comname{operatorname} we get the necessary spacing\index{spacing!in math mode} when not using parentheses
We don’t get this from \comname{mathrm}.
\begin{showlatex}{Missing spacing after~\comname{mathrm}}
Compare $\operatorname{End} V$ to $\mathrm{End} V$, and also~$2 \operatorname{Fr}(x)$ to~$\mathrm{Fr}(x)$.
\end{showlatex}



\subsection{\comtitle{newcommand}}

A very general way of defining new commands is given by \comname{newcommand}\massindex[defining commands]{newcommand}[\comname].
Its syntax is as follows:
\begin{showcode}{Syntax of \comname{newcommand}}
\newcommand{\name}[number of arguments n]{ definition including #1, ..., #n }
\end{showcode}
Consider the following example:
\begin{showlatex}{Using the command~\comname{newcommand}}
\newcommand{\bimodule}[2]{#1-#2-bimodule}
Let $M$ be an \bimodule{$A$}{$B$}.
\end{showlatex}
One may think about \comname{DeclareMathOperator} as a combination of \comname{newcommand} and \comname{operatorname}:
\begin{showlatex}{\comname{DeclareMathOperator} = \comname{newcommand} plus \comname{operatorname}}
\newcommand{\Ouv}{\operatorname{Ouv}}
$\Ouv X$
\end{showlatex}

Trying to define an already existing command with \comname{newcommand} will lead to an error.
To overwrite an already existing command one can use \comname{renewcommand}\massindex[defining commands]{renewcommand}[\comname] instead.
But this shouldn’t really be done (unless you really, \emph{really} know what you’re doing).
Even if you don’t like a particular command it may happen that some of the packages which you’re using rely on it:
overwriting the command can then easily lead to some unexpected new problems.



\subsection{\comtitle{DeclarePairedDelimiter}}
\index{delimiters!zzzz@\igobble |seealso {\comname{DeclarePairedDelimiter}}}

Mathematical operations like the absolute value~$\lvert \,\cdot\, \rvert$ and a norm~$\lVert \,\cdot\, \rVert$ are denoted by putting certain delimiters around the argument.
To define a corresponding {\LaTeX} command like~\comname{abs} or \comname{norm} one should use the command~\comname{DeclarePairedDelimiter}\massindex[defining commands]{DeclarePairedDelimiter}[\comname] (which is provided by the package~\packname{mathtools}).
\begin{showcode}{Syntax of \comname{DeclarePairedDelimiter}}
\DeclarePairedDelimiter{\name}{left delimiter}{right delimiter}
\end{showcode}
As an example we use \comname{DeclarePairedDelimiter} to define a command~\comname{abs} for absolute value:
\begin{showcode}{Defining the command~\comname{abs} with \comname{DeclarePairedDelimiter}}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\end{showcode}
The defined command can now be used as expected:
\begin{showlatex}{Using a declared delimiter}
  \[
    \abs{-5} = 5
  \]
\end{showlatex}

Declaring a command via~\comname{DeclarePairedDelimiter} will automatically also define a starred version that scales the surrounding delimiters according to the given content between them.
One can also specify a scaling size like \comname{big}\massindex[scaling]{big}[\comname], \comname{bigg}\massindex[scaling]{bigg}[\comname], etc.\ to scale the delimiters.
\begin{showlatex}{Scaling of declared delimiters}
\begin{align*}
  \abs{-\frac{1}{2}}
  &=
  \frac{1}{2} \,,
  \\
  \abs*{-\frac{1}{2}}
  &=
  \frac{1}{2} \,,
  \\
  \abs[\bigg]{-\frac{1}{2}}
  &=
  \frac{1}{2}
\end{align*}
\end{showlatex}

The variant~\comname{DeclarePairedDelimiterX}\massindex[defining commands]{DeclarePairedDelimiterX}[\comname] allows building more sophisticated commands:
\begin{showcode}{Syntax of \comname{DeclarePairedDelimiterX}}
\DeclarePairedDelimiterX{\name}
  [number of arguments n]
  {left delimiter}{right delimiter}
  {expression build from #1, #2, ..., #n}
\end{showcode}
If the built up expression contains a delimiter, then by prefixing this delimiter with the command~\comname{delimsize}\massindex[scaling]{delimsize}[\comname] will ensure that the delimiter scales in the same way as the two surrounding delimiters.
As an example we define a command~\comname{inner} for inner product.
\begin{showcode}{Using \comname{DeclarePairedDelimiterX} for more advanced delimiters}
\DeclarePairedDelimiterX{\inner}[2]{\langle}{\rangle}{#1 \,\delimsize\vert\, #2}
\end{showcode}
The defined command~\comname{inner} takes two arguments and inserts a line~(\comname{vert}) with some surrounding space~(\comname{,}) between them.
\begin{showlatex}{Using more advanced delimiters}
\[
  \inner{\psi_1}{\psi_2}
  \quad
  \inner*{\frac{f}{g}}{\frac{h}{k}}
\]
\end{showlatex}
There is also the variant~\comname{DeclarePairedDelimiterXPP}\massindex[defining commands]{DeclarePairedDelimiterXPP}[\comname] that is even more flexible than \comname{DeclarePairedDelimiterX}.
We refer to \cite{mathtools} for more details on these commands.



\subsection{The package~\packtitle{xparse}}

A useful way for defining commands -- in particular more involved ones -- is provided by the package~\packname{xparse}\massindex[packages]{xparse}[\packname].
This package provides the command~\comname{NewDocumentCommand}\massindex[defining commands]{NewDocumentCommand}[\comname].
\begin{showcode}{Syntax of \comname{NewDocumentCommand}}
\NewDocumentCommand{\name}{arguments}{definition}
\end{showcode}
The field~\inlinecode{arguments} specifies what kinds of arguments the command~\comname{name} will take:

\subsubsection{Mandatory arguments}

Mandatory arguments can be declared with the option~\optname{m}\expandafter\index\expandafter{\ciname{NewDocumentCommand}!mandatory argument}:
\begin{showlatex}{Mandatory arguments with \comname{NewDocumentCommand}~II}
% in the preamble
\NewDocumentCommand{\double}{m}{#1 #1}
% in the main text
\double{sometext}
\end{showlatex}
One can also specify multiple arguments:
\begin{showlatex}{Mandatory arguments with \comname{NewDocumentCommand}~II}
% in the preamble
\NewDocumentCommand{\swap}{m m}{#2 #1}
% in the main text
\swap{first}{second}
\end{showlatex}

\subsubsection{Optional arguments without default value}

Optional arguments can be declared with the option~\optname{o}\massindex{o}[\optname]\expandafter\index\expandafter{\ciname{NewDocumentCommand}!optional argument!without default value}.
It needs to be checked with the command~\comname{IfNoValueTF} if this optional argument was assigned a value.
\begin{showcode}[label = {syntax of ifvaluetf}]{Syntax of \comname{IfValueTF}}
\IfValueTF{#number of argument}
  {if the argument has been set}
  {if the argument has not been set}
\end{showcode}
One can similarly use~\comname{IfNoValueTF} instead of~\comname{IfNoValueTF}.
This has the same effect as switching the cases in \cref{syntax of ifvaluetf}.

Let’s look at a specific example:
\begin{showlatex}{Optional arguments with \comname{NewDocumentCommand},~I}
% in the preamble
\NewDocumentCommand
{\module}
{m o}
{\IfNoValueTF{#2}{#1-module}{#1-#2-bimodule}}
% in the main text
Let $M$ be an \module{$R$} and let $N$ be an \module{$R$}[$S$].
\end{showlatex}
It is useful to properly indent the source code.
But we have to be careful here:
It can easily happen that this indentation introduces some unwanted whitespace.
Let’s consider the naive code first:
\begin{showlatex}{Optional arguments with \comname{NewDocumentCommand},~I}
% in the preamble
\NewDocumentCommand
{\module}
{m o}
{
  \IfNoValueTF{#2}
    {#1-module}
    {#1-#2-bimodule}
}
% in the main text
Let $M$ be an \module{$R$} and let $N$ be an \module{$R$}[$S$].
\end{showlatex}
Now let’s \enquote{comment out} the additional whitespace.
\begin{showlatex}{Optional arguments with \comname{NewDocumentCommand},~I}
% in the preamble
\NewDocumentCommand
{\module}
{m o}
{%
  \IfNoValueTF{#2}
    {#1-module}
    {#1-#2-bimodule}%
}
% in the main text
Let $M$ be an \module{$R$} and let $N$ be an \module{$R$}[$S$].
\end{showlatex}

\subsubsection{Optional arguments with default value}

One can use \optname{O\{default value\}}\massindex{O\{ \}}[\optname]\expandafter\index\expandafter{\ciname{NewDocumentCommand}!optional argument!with default value} instead of \optname{o} to declare an optional argument that has a default value.

Let’s start with an example where this default value is empty:
\begin{showlatex}{Optional arguments with \comname{NewDocumentCommand},~II}
% in the preamble
\NewDocumentCommand{\restrict}{m m O{}}{#1|_{#2}^{#3}}
% in the main text
Let $f = \restrict{g}{X}$ and $f' = \restrict{g'}{X}[Y]$
\end{showlatex}
Now let’s do an example which has a standard value:
\begin{showlatex}{Optional arguments with \comname{NewDocumentCommand},~III}
% in the preamble
\NewDocumentCommand{\favorite}{O{colour} m}{My favorite #1 is #2.}
% in the main text
\favorite{blue}
\favorite[food]{spam}
\end{showlatex}

\subsubsection{Starred versions}

One can use the argument~\optname{*} together with the command~\comname{IfBooleanTF}\massindex[\ciname{NewDocumentCommand}]{IfBooleanTF}[\comname] to check for the occurrence of a star.
This can be used to also define a starred version of a command.
\begin{showlatex}{Starred versions with \comname{NewDocumentCommand}}
% in the preamble
\NewDocumentCommand{\choice}{s m m}{\IfBooleanTF{#1}{#3}{#2}}
% in the main text
Don’t confuse \choice{first}{second} with \choice*{first}{second}.
\end{showlatex}





\section{Stretch your arrows}

If some expression occurs atop or below an arrow, then this arrow must be stretched suffciently long to accommodate this expression.
The extensible arrows introduced in \cref{extensible arrows} automatically do so.



\subsection{Stretching columns}

If an arrow in a commutative diagram isn’t long enough then this arrow must also be stretched:
\begin{showlatex}{Commutative diagram with an arrow too short}
\[
\begin{tikzcd}
  X \arrow{r}{f \circ g - g \circ f} \arrow{d}
  &
  Y \arrow{r}{k} \arrow{d}
  &
  Z \arrow[equal]{d}
  \\
  X' \arrow[dashed]{r}{h'}
  &
  Y' \arrow{r}{k'}
  &
  Z'
\end{tikzcd}
\]
\end{showlatex}
The column distance of a commutative diagram is governed by the option~\optname{column~sep}\massindex[\piname{tikz-cd}]{column sep}[\optname].
The value of \optname{column~sep} is expected to be a distance, e.g.~\optname{4em}.
Some standard distances are predefined, see \cref{column sep settings}.
\begin{table}[tb]
  \begin{center}
  \begin{tabular}{@{}lcccccc@{}}
    \toprule
    \theading{name}
    &
    \optname{tiny}\massindex[\piname{tikz-cd}!\optname{column sep}]{tiny}[\optname]
    &
    \optname{small}\massindex[\piname{tikz-cd}!\optname{column sep}]{small}[\optname]
    &
    \optname{scriptsize}\massindex[\piname{tikz-cd}!\optname{column sep}]{scriptsize}[\optname]
    &
    \optname{normal}\massindex[\piname{tikz-cd}!\optname{column sep}]{normal}[\optname]
    &
    \optname{large}\massindex[\piname{tikz-cd}!\optname{column sep}]{large}[\optname]
    &
    \optname{huge}\massindex[\piname{tikz-cd}!\optname{column sep}]{huge}[\optname]
    \\
    \theading{distance}
    &
    \optname{0.6em}
    &
    \optname{1.2em}
    &
    \optname{1.8em}
    &
    \optname{2.4em}
    &
    \optname{3.6em}
    &
    \optname{4.8em}
    \\
    \bottomrule
  \end{tabular}
  \end{center}
  \caption{Standard distances for~\optname{column sep}.}
  \label{column sep settings}
\end{table}
With~\optname{column~sep} one can fix the above diagram.
\begin{showlatex}{Using~\optname{column sep}}
\[
\begin{tikzcd}[column sep = huge]
  X \arrow{r}{f \circ g - g \circ f} \arrow{d}
  &
  Y \arrow{r}{k} \arrow{d}
  &
  Z \arrow[equal]{d}
  \\
  X' \arrow[dashed]{r}{h'}
  &
  Y' \arrow{r}{k'}
  &
  Z'
\end{tikzcd}
\]
\end{showlatex}
One can also increase the width of a specific column by specifying the additional width at the correct~\&\nbd-symbol in the first row.
(In the above examples, the difference between \optname{normal} and \optname{huge} is~\optname{2.4em}.)
\begin{showlatex}{Explicit column spacing}
\[
\begin{tikzcd}
  X \arrow{r}{f \circ g - g \circ f} \arrow{d}
  &[2.4em]
  Y \arrow{r}{k} \arrow{d}
  &
  Z \arrow[equal]{d}
  \\
  X' \arrow[dashed]{r}{h'}
  &
  Y' \arrow{r}{k'}
  &
  Z'
\end{tikzcd}
\]
\end{showlatex}



\subsection{Stretch rows}

One can similarly use the option~\optname{row~sep} to change the distance of the rows.
Some predefined distances can be found in \cref{row sep settings}.
\begin{table}[tb]
  \begin{center}
  \begin{tabular}{@{}lcccccc@{}}
    \toprule
    \theading{name}
    &
    \optname{tiny}\massindex[\piname{tikz-cd}!\optname{row sep}]{tiny}[\optname]
    &
    \optname{small}\massindex[\piname{tikz-cd}!\optname{row sep}]{small}[\optname]
    &
    \optname{scriptsize}\massindex[\piname{tikz-cd}!\optname{row sep}]{scriptsize}[\optname]
    &
    \optname{normal}\massindex[\piname{tikz-cd}!\optname{row sep}]{normal}[\optname]
    &
    \optname{large}\massindex[\piname{tikz-cd}!\optname{row sep}]{large}[\optname]
    &
    \optname{huge}\massindex[\piname{tikz-cd}!\optname{row sep}]{huge}[\optname]
    \\
    \theading{distance}
    &
    \inlinecode{0.45em}
    &
    \inlinecode{0.9em}
    &
    \inlinecode{1.35em}
    &
    \inlinecode{1.8em}
    &
    \inlinecode{2.7em}
    &
    \inlinecode{3.6em}
    \\
    \bottomrule
  \end{tabular}
  \end{center}
  \caption{Standard distances for~\optname{row sep}.}
  \label{row sep settings}
\end{table}
They are the same as for~\optname{column~sep} but scaled down by a factor of~$0.75$.
One can also explicitely specify an additional space between two rows after the correct~\comname{\tbs}.
\begin{showlatex}{Using~\optname{row sep} and explicit row spacing}
\[
  \begin{tikzcd}[row sep = huge]
    A \arrow{r} \arrow{d}
    &
    B \arrow{d}
    \\
    C \arrow{r} \arrow{d}
    &
    D \arrow{d}
    \\
    E \arrow{r}
    &
    F
  \end{tikzcd}
  \qquad
  \begin{tikzcd}
    A \arrow{r} \arrow{d}
    &
    B \arrow{d}
    \\[1.8em]
    C \arrow{r} \arrow{d}
    &
    D \arrow{d}
    \\
    E \arrow{r}
    &
    F
  \end{tikzcd}
\]
\end{showlatex}




\section{Beware of spacings}

\index{spacing!in math mode|(}

{\LaTeX} classifies symbols and expressions into certain groups and then adds spacing around these symbols, which depends on the group they belong to.
Three of these groups are \enquote{operators}, \enquote{relation symbols} and \enquote{binary operations}.
The symbols~\inlinecode{=} and~\inlinecode{<} are for example treated as relations symbols, and the symbols~\inlinecode{+} and~\comname{cdot} as binary operations.
We can see in the following example how some space is automatically added around these symbols:
\begin{showlatex}{Standard spacing around relation symbols and binary operators}
\[
  a = b  \qquad  a < b  \qquad  a + b  \qquad  a \cdot b
\]
\end{showlatex}
To compare this to a version without spacing we can surround the symbols by a pair of curly brackets.
This circumvents {\LaTeX} from taking the surrounding code into consideration.
\begin{showlatex}{Disabling the standard spacing around a symbol}
\[
  a {=} b   \qquad  a {<} b  \qquad  a {+} b  \qquad  a {\cdot} b
\]
\end{showlatex}
The automatic spacing can become a problem, as the following examples illustrate:
\begin{showlatex}*{Clashing spacings around symbols}
\[
  X/\sim
  \quad
  R/\operatorname{J}(R)
  \quad
  \operatorname{id} \otimes h
\]
\end{showlatex}
These problems can be fixed by surrounding the respective symbols with curly brackets.
\begin{showlatex}*{Preventing a clash of spacings}
\[
  X/{\sim}
  \quad
  R/{\operatorname{J}(R)}
  \quad
  {\operatorname{id}} \otimes h
\]
\end{showlatex}
One can also tell {\LaTeX} a symbol should be treated.
\begin{showlatex}*{Specifying the role (and thus spacing) of a symbol}
\[
  a | b
  \quad
  a \mathop{|} b
  \quad
  a \mathrel{|} b
  \quad
  a \mathbin{|} b
\]
\end{showlatex}
We can thus define a command~\comname{divides}, which expresses that a number~$n$ divides a number~$m$, as follows:
\begin{showlatex}*{Defining and using \comname{divides}}
\newcommand{\divides}{\mathrel{|}}
\[
  n \divides m
\]
\end{showlatex}
For more on this topic we refer to \cite{tex_binrel}.

\index{spacing!in math mode|)}




